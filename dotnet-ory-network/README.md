# Secure an ASP.NET Core application using Ory Network

This repo demonstrates how you can use Ory Network or Ory Kratos with ASP.NET
Core apps. This app is not for production use and serves as an example of
integration.

## Overview

Base on the template generated by the `dotnet new mvc` command.

## Develop

### Prerequisites

1. [dotnet sdk 7.0](https://dotnet.microsoft.com/en-us/download/dotnet/7.0)
1. [Ory cli](https://www.ory.sh/docs/guides/cli/installation) - Used for
   [tunneling](https://www.ory.sh/docs/guides/cli/proxy-and-tunnel#ory-tunnel)
   traffic

Alternatively you can used the provided
[devcontainer](https://containers.dev/overview) which comes with dotnet sdk and
ory-cli preinstalled.

## Run locally

When using your own Ory Network project, you need to add the localhost endpoint
to the list of allowed urls:

```bash
ory patch project <your-project-id> \
  --replace '/services/identity/config/selfservice/allowed_return_urls=["http://localhost:5286/"]'
```

You can find your project id with the command `ory list projects`.

Start an Ory Tunnel:

```bash
ory tunnel --dev --project <your-project-slug> http://localhost:5286 &
```

If you want to use the
[playground project](https://playground.projects.oryapis.com/ui), you can call
`ory tunnel` without `--project`:

```bash
ory tunnel --dev http://localhost:5286
```

Run the app:

```bash
dotnet run --project ./src/ExampleApp
```

Open http://localhost:5286 for testing

# Run using Docker

The `Dockerfile` can be found in the [`src`](/src) folder.

Build image:

```bash
docker build src -t dotnet-example
```

Run image:

```bash
docker run -it --rm -p 5286:5286 -p 4000:4000 dotnet-example
```

You can override the ports with `APP_PORT` and `ORY_TUNNEL_PORT` environment
variables. Remember that these ports must match the portforwarding. The Ory
Network project can be specified via its url using the `ORY_PROJECT_URL`
environment variable.

Open http://localhost:5286 for testing

## Contribute

Feel free to
[open a discussion](https://github.com/ory/examples/discussions/new) to provide
feedback or talk about ideas, or
[open an issue](https://github.com/ory/examples/issues/new) if you want to add
your example to the repository or encounter a bug. You can contribute to Ory in
many ways, see the
[Ory Contributing Guidelines](https://www.ory.sh/docs/ecosystem/contributing)
for more information.
